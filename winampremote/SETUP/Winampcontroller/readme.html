<HTML>
<HEAD>
<TITLE>Winamp Controller Suite Readme</TITLE>
<STYLE TYPE = "text/css">

/* styles to be associated with specific DIVs*/

#TopLine {position: absolute ; top:0 ; left:25 ; height : 3000}

#div1 {position: absolute ; top:50 ; left:050 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}
#div2 {position: absolute ; top:075 ; left:100 ; width:500  ; height : 200 ; clip : rect(0,500,20,0)}
#div3 {position: absolute ; top:100 ; left:150 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}
#div4 {position: absolute ; top:125 ; left:200 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}
#div5 {position: absolute ; top:150 ; left:250 ; width:500  ; height : 200 ; clip : rect(0,500,20,0)}
#div6 {position: absolute ; top:175 ; left:300 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}
#div7 {position: absolute ; top:200 ; left:350 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}
#div8 {position: absolute ; top:225 ; left:400 ; width:500 ; height : 200 ; clip : rect(0,500,20,0)}

#title : {top : 0 ; left : 20; }

#headingdiv  {position:absolute ; top : 10 ; left : 300; width:300 ; height : 220 ; color: #0000ff; border-width:2pt; border-style:outset; background-color:#c0c0c0; padding: 4pt; border-color:#0000ff ; visibility : hidden}

BODY  {background-color : #c0c0c0 ; font-family : sans-serif ; font-size : 10pt}
A {font-family : sans-serif ; font-size : 12pt ; text-decoration : none}

A:link {  text-decoration: none;  color: #0000ff;  font-family: sans-serif;}A:active {  text-decoration: none;  color: #ff0000;  font-family: sans-serif;}A:visited {  text-decoration: none;  color: #ff00ff;  font-family: sans-serif;}A:hover {  text-decoration: none;  color: #ff0000;  font-family: sans-serif;}

H1, H2, H3, H4 {font-family : sans-serif}
H1 {font-size : 18pt}
H2 {font-size : 12pt}
H3 {font-size : 10pt}
H4 {font-size : 10pt}
P {font-family : sans-serif ; font-size : 10pt}
UL {font-size : 12pt}
LI {font-size : 10pt}

/*for the nice text effects*/
div { position:absolute; }


</STYLE>


<style>
.lightshade { top:+2; left:+2; color:#808080; }
.shade { top:+4; left:+4; color:#404040; }
.fill { top:0; left:0; color:blue; }
</style>


</HEAD>
<BODY onLoad = 'setup()' onResize = " if (document.layers) self.location = self.location ; else setup()">

<div ID = "title">
<div class="shade">
<h1>Winamp Remote Control</h1>
</div>
<div class="lightshade">
<h1>Winamp Remote Control</h1>
</div>
<div class="fill">
<h1>Winamp Remote Control</h1>
</div>
</div>

<div id = "TopLine">
</div>


<div id = "headingdiv">

<TABLE>
<TR>
<TD HEIGHT = "200" WIDTH = "275" VALIGN = "TOP">
<P>Readme Topics</P>
</TD>
</TR>
</TABLE>

</div>

<DIV ID = "div1">
<A HREF = "javascript: startArrange(0)">Winamp Remote Control program</A>
<P>This is the readme file for the winamp remote controller.</P>
<P>Overview:</P>
<P>Have you ever encountered one of these dire situations?</P>
<UL> 
<LI>Only one stereo, too many machines?</LI>
<LI><STRONG>Can't... Raise... Bulk... - Must... Resist... Sofa...</STRONG></LI>
<LI>I <EM>dream</EM> of the day I can put "written listening to winamp" on one of my products; 'til then, nobody must know I work with the stereo on...</LI>
<LI>We want to be able to share choosing the tracks on the winamp machine, but without playing musical chairs.</LI>
</UL>
<P>Do you have Windows machines, networked via tcp-ip*?</P>
<P>* If not, why not?</P>

<P>If so, this may be the application suite for you!</P>
<P>And it's free!</P>
</DIV>

<DIV ID = "div2">
<A HREF = "javascript: startArrange(1)">What it does:</A>
<P>The broadest overview would have to be that the winamp plugin gives winamp the ability to respond to control messages from remote machines connected via a network.</P>
<P>In more concrete terms - install the plugin, and you can control winamp on machine 1, by using a client application on machine 2.</P>
</DIV>

<DIV ID = "div3">
<A HREF = "javascript:startArrange(2)">The Client</A>
<P>Installation:</P>
<P>Simply use one of the setup options in the setup provided.</P>
<P>Use:</P>
<P>Simply get the endpoint right (machine, endpoint - read it off the server messages form), and it should just work</P>
<P>I hope the interface is fairly self-explanatory - just try it out!</P>
<P>ps - right click the tray-icon for a menu, and left click for a quick pause, when the back manager calls.<BR>
The pause code actually tests to see if the server state is consistent with what you are seeing, and does not act if winamp is already paused.<BR>
So you can *all* dive for pause at once (ish).</P>
</DIV>

<DIV ID = "div4">
<A HREF = "javascript:startArrange(3)">The Server</A>
<P>Installation:</P>
<P>Simply use the "Typical" setup or "Custom" and select the server plugin group.</P>
<P>The server plugin install option puts a shortcut to install the winamp plugin. Click on this while winamp is not running, and restart winamp - the plugin is loaded automatically by winamp at startup, and it starts to export winamp's abilities soon after, assuming all is well with your machine.</P>
<P>Use:</P>
<P>"Out of the box", this will work straight off for client, server and winamp all on the same machine.</P>
<P>To finally use the suite as intended, you will have to have a client remote to the winamp machine, that can "see" the server endpoint.</P>
<P><EM>New</EM> - now the locate servers function will find the local winamp server for you!</P>
<P><EM><BIG>*Users without a network, or only dial-up read me</BIG></EM> <BR>
- Without a known IP address, these calls, and the remote's operation can take a very long time.<BR>
In these cases, I recommend adding the line
<PRE>127.0.0.1 localhost # this is the local loopback</PRE>
to the Windows Hosts file.<BR>
What's the windows hosts file?<BR>
Well, in the Windows directory, or WinNT/System32/drivers/etc, there should be a file called (just) <PRE>HOSTS</PRE>
which contains a list of ip address lookups - win9x often has a hosts.sam sample file.<BR>
With the previous line added, the ip alias localhost is available as the local loopback address.<BR>
You could even add your machine name (try to resist the temptation to make it www.microsoft.com - it will "override" real net aliases, and prevent you going there.)</P>

</DIV>

<DIV ID = "div5">
<A HREF = "javascript:startArrange(4)">What You will need:</A>
<UL>The Installation process
<LI>Get the install files</LI>
<LI>Run setup</LI>
<LI>Select Your option<BR>
- Typical gives you the server and the client.<BR>
- Compact gives you client only.<BR>
- Custom gives you option to select the client, server and MS OpenGL options.
</LI>
<LI>Continue with the setup - to install the server, click on the "install server plugin" link</LI>
<LI>You are now ready to go - the client needs only the correct endpoint setting - the default should be OK.<BR>
If you have trouble and the server is definitely running on a machine you can 'see', have a work with your network person, if you have one.<BR>
If all else fails, drop me a line, maybe it's my fault, or I can help.</LI>
</UL>
<P>Requirements</P>
<UL>The Client
<LI>Win 9x/NT4 (dunno about NT3.5 - can anyone let me know?)</LI>
<LI>tcp-ip between the server and client on at least one port that is free you are aware of.</LI>
<LI>I <EM>think</EM> that's it</LI>
</UL>
<UL>The Server
<LI>Win 9x/NT4</LI>
<LI>tcp-ip between the client and server on at least one port that is free you are aware of.</LI>
<LI>I <EM>think</EM> that's it</LI>
</UL>

<P>Oh, and winamp and some block-rocking beats ;-)</P>
</DIV>

<DIV ID = "div6">
<A HREF = "javascript:startArrange(5)">Future Plans:</A>

<UL>Imminent (know how to do it, but must sleep...)
<LI>Client - implement multi-threading of client to prevent scary hangs<BR>Honest, it's not my fault...</LI>
</UL>

<UL>Distant (or next major version)
<LI>Properly versioned RPC interface (backwards and forwards compatibilty with all these new extensions guaranteed)</LI>
<LI>Greater set of protocols, for performance boost / ease of use on non tcpip (or just plain odd) net configurations.</LI>
<LI>Drag and dock with full view of windows - see below</LI>
<LI>Skinnable client (maybe winamp / real audio compatible)</LI>
<LI>Client "SDK"<BR>
- which may just be the IDL file - for the propellerheads out there<BR>
- or a full template project in your choice of tool (as long as it's BCB4)
Anyone wishing to port to VC can be my guest.
</LI>
<LI>Server: allow some "administrative functions" ie playlist tyranny to be applied to the client machines</LI>
</UL>

<UL>Moon shooting (no idea if facility does or can ever exist)
<LI>Client: Fix add directory function? - <EM>still open!</EM></LI>
<LI>Server: notify clients of winamp status asynchronously<BR>
I do know how to do this, but I'm not sure if is solves more problems than it fixes...</LI>
<LI>Server: I have been asked this - send back the audio / video too!<BR>
?!*@ = what kind of networks do you guys have out there?<BR>
And isn't this what Shoutcast is for?</LI>

</UL>

<UL>Total and utter drooling insanity
<LI> (moved here where it belongs) Server: execute the visualisation plugin remotely as well.<BR></LI>
<LI>Client: port to PalmOS</LI>
<LI>And Windows CE</LI>
<LI>And MAC</LI>
<LI>Server: Port to above, along with Winamp</LI>
<LI>Produce prototype Bluetooth device using interface</LI>

</UL>


</DIV>

<DIV ID = "div7">
<A HREF = "javascript:startArrange(6)">About the author:</A>
<P>what's to say - I hope to let my work speak for itself</P>

<P>Get in touch:</P>
<P>I have too few machines, or access to others',
and too few network configurations to be able to test this thoroughly<P>
<P>If anyone notices any problems / interface quirks, I would love to hear from them:
<A HREF = "mailto:patrickmmartin@freenet.co.uk">patrickmmartin@freenet.co.uk</A></P>
</DIV>

<DIV ID = "div8">
<A HREF = "javascript:startArrange(7)">Application History:</A>
<UL>

<LI>30/08/00 thirteenth release - drag and <em>dock</em> fun! <BR>
	</LI>
        

	<UL>Server enhancements:
	<LI>Small enhancment to clients view.</LI>
	<LI>Default port now chosen to one more likely to be free.</LI>
	<LI>List of known ports now 1000 items long (should help debugging RPC bind problems).</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Children forms can be dragged and docked to main window. State is of course, persistent. Enjoy.</LI>
	</UL>




<LI>22/08/00 twelfth release - drag and drop fun! <BR>
	</LI>

	<UL>Server enhancements:
	<LI>None, though maybe it's getting to be time.</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Drag into the playlist window inserts into list at drop point.<BR>
	A bit of a performance hit, but what the hey?
	</LI>
	<LI>Dragging selected files within the playlist window also inserts into list at drop point.
	</LI>
	<LI>Autoload button on EQ form.</LI>
	</UL>




<LI>18/07/00 eleventh release - new header file from Nullsoft! <BR>
	</LI>

	<UL>Server enhancements:
	<LI>Fuller list of commands with descriptions!<BR>
	(OK, not very important)</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Shuffle and repeat now display their values - try the menus!<BR>
	These behave as per pause i.e. if your display state is correct, the action is invoked.</LI>
	<LI>EQ is working!<BR>
	The behaviour is a little "beta", owing to the truly bizarre way winamp implements getting and setting the properties.<BR>
	The upshot is that for performance reasons, and to avoid users interfering with each other, the EQ is not updated regularly.<BR>
	Try the refresh button to see the results.<BR>
	Oh, and the winamp skin doesn't update, thought the settings are altered...<BR>
	You can alter it and see (and hear?) the results, however.</LI>
	</UL>



<LI>18/07/00 tenth release - new "locate servers" function - connect yourself up with as little hassle as possible <BR>
	</LI>

	<UL>Server enhancements:
	<LI>Suggestions have kept on rolling in - still under consideration!</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Any machines in the netwoprk neightbourhood can be "automatically" located and tested.</LI>
	</UL>



<LI>07/06/00 ninth release - upgraded to C++ builder 4 - nice!, interface enhancements and few bug fixes <BR>
	</LI>
	<UL>Server enhancements:
	<LI>Some more optimisations - should be a little bit more efficient on slower machines</LI>
	<LI>Suggestions have been rolling in - now under consideration</LI>
	</UL>
	<UL>Client enhancements:
	<LI>interface overhaul - hope you like it.</LI>
	<LI>nice full colour pictures.</LI>
	<LI>overhaul of popup menu, should be more usable.</LI>
	<LI>Bug fixed where update on song change kicked off endless updates.</LI>
	</UL>



<LI>07/05/00 eighth release - minor interface changes and optimisations for the client<BR>
	</LI>
	
	<UL>Server enhancements:
	<LI>Icon animations for the clients connected - these do happen when there are client requests<br>
	I hope it's useful to people (or just amusing)</LI>
	<LI>string size returned clamped down to MAX_PATH<br>
	- I hope this is the right upper limit, though you would have to go pretty over the top to hit this limit</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Various tweaks to attempt a consistent view when large fonts is on.</LI>
	<LI>Slight change to commands toolbar as a result of the above.</LI>
	<LI>Bug fixed where two updates of the playlist were being
	performed for one change of the list - this should save some time for those long playlists.</LI>
	</UL>


<LI>31/03/00 seventh release - minor interface changes and optimisations for the client<BR>
	</LI>
	
	<UL>Server enhancements:
	<LI>None - can you believe it?</LI>
	</UL>
	<UL>Client enhancements:
	<LI>Some configurability and efficiency enhancements.</LI>
	<UL>
	<LI>You can chose whether to automatically hide the upon startup.</LI>
	<LI>You can chose whether to automatically restore the child windows .</LI>
	<LI>The server poll interval is remembered, and has a niftier control (I think).</LI>
	<LI>More subtly, the behaviour of the playlist editor has altered.
	If the update when list changes option (now default) is chosen, the list is not reloaded every song play.
	The other setting is as before: refresh the list every time the song changes.
	It's hard for the playlist to get out of step, but it can be a little hard on the network.
	I hope this takes some of the pain away.</LI>
	</UL>
	</UL>


<LI>31/03/00 sixth release - minor interface enhancements of the client and server<BR>
	</LI>
	
	<UL>Server enhancements:
	<LI>The problem with non-thread safe code leading to intermittent corruption of the playlists for multiple clients is fixed:</LI>
	<LI>the visible state of the server messages window is persistent.</LI>
	<LI>animation of icons is still coming in the next version, see below.</LI>
	</UL>
	<UL>Client enhancements:
	<LI>The behaviour and number of sub forms has altered.</LI>
	<UL>
	<LI>The network configuration is hideable, and the server poll time is configurable</LI>
	<LI>The playlist form supports delete and drag and drop. Hope this is more useful. It's a little heavy on the network to delete, so be sparing</LI>
	<LI>There is a new commands "toolbar" ,which can be used for ultra-friendly access to the basic commands.</LI>
	<LI>The visibility and position of all the forms is saved on exit, and restored. Nice...</LI>
	</UL>
	</UL>



<LI>05/03/00 fifth release - minor interface enhancements of the client and server<BR>
	</LI>
	
	<UL>Server enhancements:
	<LI>The server messages form has some nice new windows and enhancements:</LI>
	<UL>
	<LI>the visible state of the server messages window is persistent.</LI>
	<LI>the current clients of the server and their status are shown in a nice view (animation next version, once the images are good enough).</LI>
	<LI>the notification messages added to the messages window are selectable. Just <EM>who</EM> is it who keeps skipping my favourite track?</LI>
	</LI>
	</UL>
	</UL>
	<UL>Client enhancements:
	<LI>The behaviour and number of sub forms has altered.</LI>
	<UL>
	<LI>The playlist form gets told of song / playlist changes, and is a bit more efficient/stingy about getting the entire playlist.</LI>
	<LI>There is a volume and balance form that works interactively. Sorry, the initial values of these are nonsense until you move them. This isn't my fault, and I'm trying to think of a way around it.</LI>
	</UL>
	</UL>



<LI>05/03/00 fourth release - major upgrade of the server<BR>
	</LI>
	
	<UL>New Features:
	<LI>new server approach<BR>
	The server is no longer a stand-alone exe, but a generic plugin loaded in-process by winamp upon startup.<BR>
	- what this gives you is a single-click winamp server.<BR>
	The server can be monitored by going to Plugins > General > Configure and selecting the pmmsoft RPC interface entry.<BR>
	The server can be configured to use different ports on the fly, and the settings are persistent.<BR>
	Warnings are issued for all RFC1060 ports (which didn't include http ?!)  -and http.<BR>
	You should only use such ports if you really have to, and you know what you are doing.
	</LI>
	<LI>new features to the interface<BR>
	<UL>
	<LI>The client remembers the endpoint settings at the last shutdown, and also hides itself to the taskbar if it was shut down from the taskbar, but only if the initial connect to the server was successful.</LI>
	<LI>The client can now show the current song title, and the winamp version.</LI>
	<LI>The full playlist is available, and can be deleted/added to using add files with a right-click menu.</LI>
	</UL>
	</LI>
	</UL>



<LI>05/03/00 third release - major upgrade of the interface<BR>
	</LI>
	
	<UL>New Features:
	<LI>interface redesign<BR>
	The server is now intended to be entirely a pass-through server<BR>
	- as winamp gains capabilities, the client can be altered to exploit them, and different/new ideas can be tried in the client(s?) without alteration of the server.<BR>
	The server interface is independent of the previous version, and they can run side by side.</LI>
	<LI>Winamp status is now returned!<BR>
	Winamp's playing status is polled every second, where the RPC call succeeds, and every 5s after a failure.<BR>
	The status is displayed on the new-look form and the taskbar.</LI>
	<LI>Client is now registry aware - settings are per user, and loaded/saved on startup/shutdown.<BR>
	Some more options, and a few cosmetic alterations.</LI>
	<LI>Pause now checks for the status, and displays the appropriate action.<BR>
	More crucially, pause checks winamp's state and only pauses where appropriate (this can catch people out otherwise in an office).</LI>
	<LI>The old style interface for sending strings appears to be broken in winamp V2.6 (access violation and crashes out)<BR>
	so, have to change approach. This means add directory does not work - don't know why.<BR>
	However, add file accepts multiple files, so no great loss there.</LI>
	</UL>


<LI>15/02/00 second release <BR>
	</LI>
	
	<UL>Bug Fixes:
	<LI>Add file/playlist/directory was broken in the last version<BR>
	<P>sorry!</P>
	now fixed, though I will be putting a bit more thought into this whole area<BR>
	re: machines not on an NT domain - any suggestions, anyone?<BR>
	Stay tuned.</LI>
	</UL>



<LI>05/02/00 first release candidate<BR>
	</LI>
	
	<UL>Features:
	<LI>Client</LI>
	<LI>Networking<BR>
	Uses tcp/ip and (through no effort of my own )WINS to allow local machine names and port nos to be specified for the server.</LI>
	<LI>Server<BR>
	Simply start it up, the port is hard-coded (sorry), and the machine name and the port number are displayed.<BR>
	If winamp is running on that machine, it should be able to send messages to it, as far as I know.<BR>
	There is minimal messaging for errors.
	</LI>
	</UL>
	
	<UL>Fatal Problems/Bugs:
	<LI>OpenGL<BR>
	None known of, though there are some problems I have in debugging that don't appear to be reproducible in 'real life'.</LI>
	<LI>Windows95<BR>
	Windows 95a doesn't have the MS OpenGL as a default; win95b upwards do, so the inclusion of the OpenGl libraries is intended as a convenience. Having said that, anyone encountering display problems on their system could try installing with that options, as they are the target I built and tested against.<BR>
	Use the included dlls, and the recommendation is to install them in app. directory</LI>
	<LI>Windows98<BR>
	None known</LI>
	<LI>WindowsNT4<BR>
	None Known</LI>
	</UL>

	<UL>Non-Fatal/UI Problems/Bugs:
	<LI>Many, no doubt. I am perfectly open to suggestions for enhancements, though I should point out that the client application employs the full set of documented winamp commands I am [a] aware of [b] could get to work. A case in point is Add Directory, which had to disappear with the advent of winamp 2.6, as one of the IPC methods used to communicate with it invariably crashed winamp, and the other just does nothing.</LI>
	</UL>
</UL>
</DIV>


<BODY>

<SCRIPT>

function getLayer(id){
//cross-browser layer access by layer name
//only works for flat layer hierarchies
  if (document.layers) {
   if (document.layers[id]){
     return document.layers[id];
      }
    }
  if (document.all){
    if (document.all[id]){
      return document.all[id];
      }
    }
  return null;
  }


function point(x, y){
//returns a point
  this.x = 0;
  this.y = 0;
  if (x) this.x = x;
  if (y) this.y = y;
  return this;
  }



function getPos(layer){
//cross browser position returning
  result = new point();
  if (document.layers){
    result.x = layer.left;
    result.y = layer.top;
    }
  if (document.all){
    result.x = layer.style.posLeft;
    result.y = layer.style.posTop;
    }
  return result;
  }


function setPos(layer, pospoint){
// cross browser layer positioning
  if (document.layers){
    layer.left = pospoint.x;
    layer.top = pospoint.y;
    }
  if (document.all){
    layer.style.posLeft = pospoint.x;
    layer.style.posTop = pospoint.y;
    }
  }


function setClip(lyr, left, right, bottom, top) {
    if (document.all) {
      lyr.style.clip = 'rect(' + left + ',' + right + ',' + bottom + ',' + top + ')';
    }
    if (document.layers) {
      lyr.clip.right = right;
      lyr.clip.left = left;
      lyr.clip.top = top;
      lyr.clip.bottom = bottom;
    }
  }


var spiral = 0;

function glideLayer(lyr, endpoint, magnitude, onend, endparam){
//moves toward the end coord distance of magnitude
  var layerpos = getPos(lyr);

  var xd = layerpos.x - endpoint.x;
  var yd = layerpos.y - endpoint.y;

  var layerangle = Math.atan2(yd, xd);
  
  var hd = Math.sqrt((xd * xd) + (yd * yd)); 

  layerangle +=  (spiral / 180) * Math.PI;
    
  if (hd > magnitude){
    xd = layerpos.x - (magnitude * Math.cos(layerangle));
    yd = layerpos.y - (magnitude * Math.sin(layerangle));
    }
  else{
    xd = endpoint.x;
    yd = endpoint.y;
   // call event
    if (onend){
      onend(endparam);
      }
    }

  setPos(lyr, new point(xd, yd));  
  }


function getWindowSize(){
var result = new point;
  if (window.innerWidth){
    result.x = window.innerWidth - 75;
    }

  if (document.body){
    result.x = document.body.clientWidth - 75;
    }

  if (window.innerHeight){
    result.y = window.innerHeight - 25;
    }

  if (document.body){
    result.y = document.body.clientHeight - 30;
    }
  return result;
  }


function showLayer(lyr, showlyr){

  if (showlyr==false){
    visible = 'hidden';
    }
  else{
    visible = 'visible';
    }
  if (lyr){
    if (document.all){
      lyr.style.visibility = visible;
      }
    else if (document.layers){
      lyr.visibility = visible;
      }
    }
  }


var winsize = null;


function setup(){
  winsize = getWindowSize();
  lyrarray = new Array(getLayer('div1'), getLayer('div2'), getLayer('div3'), getLayer('div4'), getLayer('div5'), getLayer('div6'), getLayer('div7'), getLayer('div8'));
  var lyr = getLayer('headingdiv');
  if (lyr){
    setPos(lyr, new point(winsize.x - 245, 30));
    showLayer(lyr);
    }
  startArrange(0);
  }


function clipLayer(lyr, unclip){
    if (unclip){
     setClip(lyr, 0, 500, 3000, 0);
      }
    else{
     setClip(lyr, 0, 500, 20, 0);
      }
  }


function endArrange(index){
  if (arrived[index] == false){
    arrived[index] = true;
    arrivedcount++
    if (index == movingindex){
      clipLayer(lyrarray[index], true);
      }
    }
  if (arrivedcount == lyrarray.length){
    movetimer = 0;
    }
  }

var selected = null;
var unselected = null;
var lastmoved = null;
var lyrarray = null;
var arrived = null;
var finishpoint = new point(20, 50);
var movingindex = 0;
var movetimer = 0;
var arrivedcount = 0;

function doArrange(){

  var now = new Date();
  magnitude = (now.getTime() - lastmoved.getTime()) / 5;

  var count = 0;
  for (var i = 0; i < lyrarray.length ; i++){
      if (i == movingindex){
    if (!arrived[i]){
          glideLayer(lyrarray[i], finishpoint, 20, endArrange, i);
          }
        }
      else{
    if (!arrived[i]){
          glideLayer(lyrarray[i], new point((winsize.x - 200) + 100 * (count % 2), 70 + 50 * (Math.floor(count / 2) + 0.5 * (count % 2) ) ), 20, endArrange, i);
          }
        count++;
        }
      }
  lastmoved = new Date();

  if (arrivedcount != lyrarray.length){
    movetimer = setTimeout('doArrange()', 20);
    }
  }

function startArrange(index){
  movingindex = index;
  arrivedcount = 0;
  lastmoved = new Date();
  arrived = new Array();
  for (var i = 0; i < lyrarray.length ; i++){    
    arrived[i] = false;
    clipLayer(lyrarray[i], false)
    }
  if (!movetimer){
    doArrange();
    }
  }


</SCRIPT>

</HTML>
